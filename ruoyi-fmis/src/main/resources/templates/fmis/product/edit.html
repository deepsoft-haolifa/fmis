<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('修改业务产品')" />
    <th:block th:include="include :: select2-css" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-product-edit" th:object="${bizProduct}">
            <input name="productId" th:field="*{productId}" type="hidden">


            <div class="form-group">    
                <label class="col-sm-3 control-label">产品名称：</label>
                <div class="col-sm-8">
                    <input name="name" th:field="*{name}" class="form-control" type="text">
                </div>
            </div>

            <!--
            <div class="form-group">    
                <label class="col-sm-3 control-label">系列 数据字典：</label>
                <div class="col-sm-8">
                    <input name="series" th:field="*{series}" class="form-control" type="text">
                </div>
            </div>-->

            <div class="form-group">
                <label class="col-sm-3 control-label">类别：</label>
                <div class="col-sm-8">
                    <select name="series" id="series" class="form-control select2-multiple" > <!--multiple-->
                        <option>请选择</option>
                        <option th:each="series:${seriesSelect}" th:value="${series.dictId}" th:text="${series.name} + ' ' + ${series.code}" ></option>
                    </select>
                </div>
            </div>

            <div class="form-group">    
                <label class="col-sm-3 control-label">产品型号：</label>
                <div class="col-sm-8">
                    <input name="model" th:field="*{model}" class="form-control" type="text">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">规格：</label>
                <div class="col-sm-8">
                    <select name="specifications" id="specifications" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">公称压力：</label>
                <div class="col-sm-8">
                    <select name="nominalPressure" id="nominalPressure" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-3 control-label">连接方式：</label>
                <div class="col-sm-8">
                    <select name="connectionType" id="connectionType" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">结构形式：</label>
                <div class="col-sm-8">
                    <select name="structuralStyle" id="structuralStyle" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">阀体材质：</label>
                <div class="col-sm-8">
                    <select name="valvebodyMaterial" id="valvebodyMaterial" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>

            <!--

            <div class="form-group">
                <label class="col-sm-3 control-label">阀板材质：</label>
                <div class="col-sm-8">
                    <input id="valveMaterial" name="valveMaterial" class="form-control" th:field="*{valveMaterial}" type="text">
                </div>
            </div>
            -->
            <div class="form-group">
                <label class="col-sm-3 control-label">密封材质：</label>
                <div class="col-sm-8">
                    <select name="sealingMaterial" id="sealingMaterial" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">阀芯材质：</label>
                <div class="col-sm-8">
                    <select name="valveElement" id="valveElement" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">驱动形式：</label>
                <div class="col-sm-8">
                    <select name="driveForm" id="driveForm" class="form-control select2-multiple" ><option>请选择</option></select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">产品单价：</label>
                <div class="col-sm-8">
                    <input name="price" th:field="*{price}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">供应商名称：</label>
                <div class="col-sm-8">
                    <select name="supplier" id="supplier" class="form-control select2-multiple" > <!--multiple-->
                        <option>请选择</option>
                        <option th:each="supplier:${suppliers}" th:value="${supplier.suppliersId}" th:text="${supplier.name}" th:selected="${supplier.flag}"></option>
                    </select>
                    <input name="newSupplier" class="form-control" th:field="*{newSupplier}" type="text" placeholder="新供应商输入">
                </div>
            </div>



            <div class="form-group">
                <label class="col-sm-3 control-label">介质：</label>
                <div class="col-sm-8">
                    <input name="medium" class="form-control" th:field="*{medium}" type="text">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">温度：</label>
                <div class="col-sm-8">
                    <input name="temperature" class="form-control" th:field="*{temperature}" type="text">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">其他：</label>
                <div class="col-sm-8">
                    <input name="other" class="form-control" th:field="*{other}" type="text">
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-3 control-label">备注：</label>
                <div class="col-sm-8">
                    <input name="remark" class="form-control" type="text" th:field="*{remark}">
                </div>
            </div>


        </form>
    </div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: select2-js" />
    <script type="text/javascript">
        var prefix = ctx + "fmis/product";
        $("#form-product-edit").validate({
            focusCleanup: true
        });

        $("#series").change(function (){
            var series = $("#series").val();
            console.log("series=" + series);
            if (series == null || series == "请选择") {
                $("#specifications").html("");
                $("#nominalPressure").html("");
                $("#connectionType").html("");
                $("#sealingMaterial").html("");
                $("#valveElement").html("");
                $("#driveForm").html("");
                $("#valvebodyMaterial").html("");
                $("#structuralStyle").html("");
                return;
            }
            $.ajax({
                url:prefix + "/findProductTypeDict",
                type : "post",
                data : {"dictId" : series},
                success : function (data) {
                    var specificationArray = data["specification"];
                    setDataToOption(specificationArray,"specifications");

                    //nominalPressure
                    var nominalPressures = data["nominalPressure"];
                    setDataToOption(nominalPressures,"nominalPressure");

                    var linkTypes = data["linkType"];
                    setDataToOption(linkTypes,"connectionType");

                    var sealingMaterials = data["sealingMaterial"];
                    setDataToOption(sealingMaterials,"sealingMaterial");

                    var spoolMaterials = data["spoolMaterial"];//valveElement
                    setDataToOption(spoolMaterials,"valveElement");

                    var driveModes = data["driveMode"];
                    setDataToOption(driveModes,"driveForm");

                    //bodyMaterial
                    var bodyMaterials = data["bodyMaterial"];
                    setDataToOption(bodyMaterials,"valvebodyMaterial");

                    var structuralStyles = data["structuralStyle"];
                    setDataToOption(structuralStyles,"structuralStyle");
                }
            })
        });
        var specificationProduct = "[[${bizProduct.specifications}]]";
        var nominalPressureProduct = "[[${bizProduct.nominalPressure}]]";

        var connectionTypeProduct = "[[${bizProduct.connectionType}]]";
        var valvebodyMaterialProduct = "[[${bizProduct.valvebodyMaterial}]]";
        var sealingMaterialProduct = "[[${bizProduct.sealingMaterial}]]";
        var valveElementProduct = "[[${bizProduct.valveElement}]]";
        var driveFormProduct = "[[${bizProduct.driveForm}]]";

        var structuralStyleProduct = "[[${bizProduct.structuralStyle}]]";

        function setDataToOption(dataArray,selectId) {
            $("#" + selectId).html("");
            $("#" + selectId).append("<option>请选择</option>")
            for (var i = 0; i < dataArray.length; i++) {
                var specificationObj = dataArray[i];
                var selectStr = "";
                if (nominalPressureProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (specificationProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (connectionTypeProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (valvebodyMaterialProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (sealingMaterialProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (valveElementProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (driveFormProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                } else if (structuralStyleProduct.toString() == specificationObj.dictId.toString()) {
                    selectStr = "selected";
                }
                $("#" + selectId).append("<option value='" + specificationObj.dictId + "' " + selectStr + ">" + specificationObj.name + "</option>")
            }
        }


        var seriesObj = "[[${bizProduct.series}]]";

        $("#series option").each(function () {
            var val = $(this).val();
            var text = $(this).text();
            if (val.toString() == seriesObj.toString()) {
                $("#series").val(val);
                $("#series").trigger("change");
            }
        });


        function submitHandler() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/edit", $('#form-product-edit').serialize());
            }
        }
    </script>
</body>
</html>